<h1>trace:视线追踪</h1>
```glsl
float heightMapTracing(vec3 ori, vec3 dir, out vec3 p) {
    float tm = 0.0;
    float tx = 1000.0;
    float hx = map(ori + dir * tx);
    if(hx > 0.0) {
        p = ori + dir * tx;
        return tx;
    }
    float hm = map(ori);
    for(int i = 0; i < NUM_STEPS; i++) {
        float tmid = mix(tm, tx, hm / (hm - hx));
        p = ori + dir * tmid;
        float hmid = map(p);
        if(hmid < 0.0) {
            tx = tmid;
            hx = hmid;
        } else {
            tm = tmid;
            hm = hmid;
        }
        if(abs(hmid) < EPSILON)
            break;
    }
    return mix(tm, tx, hm / (hm - hx));
}
```
代码介绍：
沿着方向向量 dir 进行高度图追踪，用来确定射线（从 ori 出发）在海面上与波浪表面的交点。
这是一个典型的“射线追踪”算法，用于在三维空间中找到射线与波浪表面的交点。
这个函数通过迭代的方法逼近出射线与波浪表面的精确交点，并输出该交点 p。

射线追踪：heightMapTracing 的核心思想是“二分逼近”法，通过不断缩小射线与波浪表面交点的距离范围，逐步逼近射线与海面交点的位置。
高度图查询：map 函数是用来确定某个点 p 的海面高度，因此每次迭代都调用 map 来计算射线路径上某个位置的波浪高度，判断射线是否穿过了波浪表面。
迭代逼近：通过 NUM_STEPS 的迭代，逐步缩小射线路径上的区间，使得交点的估计值越来越精确。


工作原理：
输入参数：
vec3 ori: 射线的起点，通常代表观察者或相机的位置。
vec3 dir: 射线的方向向量，代表从观察者到屏幕上的某个点的方向。
out vec3 p: 输出参数，返回射线与海面交点的位置。
返回值：
返回一个浮点值，表示交点的深度值（即从射线原点 ori 出发，到达交点的距离）。
工作步骤：
初始区间:

tm 被初始化为 0.0，代表射线从原点开始的位置。
tx 被初始化为 1000.0，这是一个很大的值，表示远处的边界，用来作为射线的最大步长。
第一步测试：计算射线在 tx 处的高度 hx，即 hx = map(ori + dir * tx)，如果 hx > 0.0，表示射线在这个大距离下仍然在波浪表面之上，直接返回 tx 并更新 p。
开始迭代:

如果 hx <= 0.0，表示射线在 tx 处穿过了海面，需要在射线的路径上继续逼近交点。
hm = map(ori)：首先计算射线起点处 ori 的高度 hm。
迭代逼近：

for 循环中，迭代 NUM_STEPS 次，每次迭代都尝试逼近射线与海面交点的位置。
插值：使用 mix 函数计算 tmid，它通过将 tm 和 tx 之间的中间位置按照 hm 和 hx 的比值进行线性插值，这是一种二分法逼近交点的方式。
更新交点：p = ori + dir * tmid，这一步计算出新的估计交点 p。
高度测试：调用 map(p) 来计算这个估计点 p 的高度 hmid，从而判断交点是否在水面之上或之下。
如果 hmid < 0.0，说明交点在波浪之下，将 tx 更新为 tmid，并更新 hx 为 hmid。
否则，将 tm 更新为 tmid，并更新 hm。
终止条件：如果 hmid 的绝对值小于 EPSILON，表示已经非常接近海面交点，可以提前终止迭代。
返回结果：

最后，函数返回 tm 和 tx 的插值结果，这个值表示从射线原点 ori 到海面交点的距离。
同时，p 已经被更新为射线与波浪表面的交点位置。



用途：
海面渲染：这个函数用于确定从相机发出的射线何时与海面相交，从而计算屏幕上某个像素应该显示的颜色（通过海面反射、折射的计算）。
物理模拟：虽然这是在片段着色器中执行的，但这个方法也可以用于物理模拟中，例如模拟水面反射或光影追踪时计算光线的路径。